# How we use GitHub (and Git in general)
Here at Kvalifik, we use Git for version controlling our code and GitHub for hosting our repositories, running CI/CD tasks and managing pull requests, issues and code reviews.
It is in general a good idea to get a solid understanding of the fundementals of Git before dwelving into this. [Here is a guide for learning how to use git](https://rogerdudler.github.io/git-guide/).

## Teams
If you work 15 hours or more each week as a developer at Kvalifik then you should be admin of our GitHub organization. Otherwise you will get access to the individual repositories as needed â€“ some of these repositories are grouped in teams, for instance "Mikkeller". Interns are part of a team called 'Interns' which have access to a specific subset of repositories.

## Branches
We use Gitflow as our branching strategy. Read more about it [here](https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow).
Each repository has a default branch. This should be set to a branch named `staging`, and should represent the state of the staging environment of the application (called `develop` in the Gitflow documentation).
Each repository should also have a branch called `production`, which stores our production code (called `main` in the Gitflow documentation).
Each feature branch should have the name `feature/[issue-id]-[title]` corresponding to the Github issue ID and the title of the issue. *You may only push to a feature branch, never directly to staging nor production*.

> Note: Some Shopify projects (notably shop.mikkeller.dk) use a three-tier infrastructure of development-staging-production

## Issues
We use Github issues to connect tasks to pull requests and to easily work on tasks through the [Kvalifik CLI](https://github.com/Kvalifik/Kvalifik-CLI). The issues are populated through Forecast by Forecast's Github integration.

## Pull Requests
We use Github pull requests to manage pending code changes. A pull request should be linked to an issue that it solves, and should always go from a feature branch to the `staging` branch. It is also possible to make a pull request from the `staging` branch to the `production` branch, *but no pull request should ever go from a feature branch to the production branch!*. Pull requests are automatically generated by the Kvalifik CLI, and should be created as a draft pull request as soon as one starts working on an issue. It shall stay as a draft until it is ready for review. All programmers should aspire to keep pull requests small, but plenty.

## Code Reviews
We use Code Reviews to review and approve code changes to the `staging` branch. Every pull request needs a code review to be merged, and everyone can perform a code review.

## Continuous Integration
We use Continuous Integration through Github Actions to perform lint checks, run tests, build software and perform static validations on the code before we merge into `staging` or `production`. A branch shall only be merged when all checks have passed.

## Continuous Deployment
We use Continous Deployment through Github Actions to deploy our code to its respective platforms. This happens whenever code is merged into `staging` or `production`.

> Exception: Our Next.js projects have their deployment managed by Vercel

## Commits and Commit Messages
We aspire to keep commits small and plenty. They should only contain relevant hunks and their commit message should be accurately describing the change that the hunk implements. Upon merging into `staging`, we squash all commits of a pull request into a single commit.

## Merge Conflicts
Merge conflicts are handled locally, not by the web gui. Please test your code whenever a merge conflict is handled, and push the merge changes to the feature branch after you are done.

## 2-factor authentication
It is required that 2-factor authentication is implemented on your account before you gain access to the Kvalifik Github Organization.
It is highly recommended to [connect SSH keys to your Github account](https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh).

## Forecast Integration
All projects should have the Forecast integration enabled. It can be enabled on the forecast project under "Settings".

## Branch rules
Each repository should have the following branch rules:
For branches matching `/staging/`:
- Require pull request reviews before merging
- Require status checks to pass before merging
- Require branches to be up to date before merging

For branches matching  `/production/`:
- Require status checks to pass before merging
- Require branches to be up to date before merging
